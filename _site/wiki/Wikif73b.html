











<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html id="top" xmlns="http://www.w3.org/1999/xhtml">


<!-- Mirrored from rsf.fluidproject.org/wiki/Wiki.jsp?page=OTP by HTTrack Website Copier/3.x [XR&CO'2013], Fri, 07 Jun 2013 15:00:31 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
  <title>
    RSF Wiki: OTP
  </title>
  











<link rel="stylesheet" media="screen, projection, print" type="text/css"
     href="templates/default/jspwiki.css"/>

<link rel="stylesheet" type="text/css" media="print" 
     href="templates/default/jspwiki_print.css" />
<!-- INCLUDERESOURCES (stylesheet) -->

<!-- INCLUDERESOURCES (inlinecss) -->



<noscript>
<style type="text/css">
#hiddenmorepopup { display:block; }
</style>
</noscript>


<script type="text/javascript" src="scripts/mootools.js"></script>
<script type="text/javascript" src="scripts/prettify.js"></script>
<script type="text/javascript" src="scripts/jspwiki-common.js"></script>
<script type="text/javascript" src="scripts/jspwiki-commonstyles.js"></script>
<!-- INCLUDERESOURCES (script) -->





<meta name="wikiContext" content='view' />
<meta name="wikiBaseUrl" content='http://rsf.fluidproject.org/wiki/' />
<meta name="wikiPageUrl" content='/wiki/Wiki.jsp?page=%23%24%25' />
<meta name="wikiEditUrl" content='/wiki/Edit.jsp?page=OTP' />
<meta name="wikiJsonUrl" content='/wiki/JSON-RPC' />
<meta name="wikiPageName" content='OTP' />
<meta name="wikiUserName" content='207.119.0.6' />
<meta name="wikiTemplateUrl" content='/wiki/templates/default/' />
<meta name="wikiApplicationName" content='RSF Wiki' />

<script type="text/javascript">//<![CDATA[
/* Localized javascript strings: LocalizedStrings[] */
var LocalizedStrings = {
"javascript.edit.allsections":"( All )",
"javascript.slimbox.error":"<h2>Error</h2>There was a problem with your request.<br />Please try again",
"javascript.slimbox.remoteRequest":"Remote Request {0} of {1}",
"javascript.slimbox.close":"Close &#215;",
"javascript.quick.edit":"[Edit]",
"javascript.sort.descending":"Descending order. Click to reverse sort order",
"javascript.expand":"Click to expand",
"javascript.group.validName":"Please provide a valid name for the new Group",
"javascript.slimbox.next":"Next&raquo;",
"javascript.filter.all":"( All )",
"javascript.edit.areyousure":"Without clicking the Save button, your changes will be lost. Are you sure you want to exit this page?",
"javascript.quick.edit.title":"Edit section {0}...",
"javascript.slimbox.directLink":"Direct Link to the target",
"javascript.prefs.areyousure":"Without clicking the Save User Preferences button, your changes will be lost. Are you sure you want to exit this page?",
"javascript.sbox.clone.suffix":"-New",
"javascript.slimbox.info":"Image {0} of {1}",
"javascript.tip.default.title":"More...",
"javascript.edit.resize":"Drag to resize the text area",
"javascript.edit.findandreplace.nomatch":"No match found!",
"javascript.sort.ascending":"Ascending order. Click to reverse sort order",
"javascript.slimbox.close.title":"Close [Esc]",
"javascript.edit.toolbar.makeSelection":"Please make first a selection.",
"javascript.favs.hide":"Click to hide Favorites",
"javascript.sectionediting.label":"Section Overview",
"javascript.slimbox.previous":"&laquo;Previous",
"javascript.favs.show":"Click to show Favorites",
"javascript.collapse":"Click to collapse",
"javascript.category.title":"Click to show category [{0}] ...",
"javascript.sort.click":"Click to sort",
"javascript.edit.startOfPage":"( Start of page )"
};


/* INCLUDERESOURCES (jsfunction) */

//]]></script>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="search" href="Wiki702d.html?page=FindPage"
    title='Search RSF Wiki' />
<link rel="help"   href="Wikia3b7.html?page=TextFormattingRules"
    title="Help" />

 <link rel="start"  href="Wikib2ab.html?page=Main"
    title="Front page" />
<link rel="alternate stylesheet" type="text/css" href="templates/default/jspwiki_print.css"
    title="Print friendly" />
<link rel="alternate stylesheet" type="text/css" href="templates/default/jspwiki.css"
    title="Standard" />
<link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico" />

<link rel="icon" type="image/x-icon" href="images/favicon.ico" />



  









  
  
  
</head>

<body class="view">

<div id="wikibody" class="fav-left">
 
  






<div id="header">

  <div class="titlebox"></div>

  <div class="applicationlogo" > 
    <a href="Wikib2ab.html?page=Main"
       title="Go to home page Main ">Home</a>
  </div>

  <div class="companylogo"></div>

  






<div class="userbox">

  
    <span class="username anonymous">
      G&#8217;day (anonymous guest)
    </span>
  
  
  

  
  
  
    
      <a href="Loginae2f.html?redirect=OTP" 
        class="action login"
        title="Log in or Register as new user">Log in</a>
    
  
  
  
  

  
  
    <a href="UserPreferencesae2f.html?redirect=OTP"
      class="action prefs" accesskey="p"
      title="Manage your preferences [ p ]">My <span class='accesskey'>P</span>refs
    </a>
  
  

  <div class="clearbox"></div>

</div>

  <div class="pagename">OTP</div>

  <div class="searchbox">






<form action="http://rsf.fluidproject.org/wiki/Search.jsp"
        class="wikiform"
           id="searchForm" accept-charset="UTF-8">

  <div style="position:relative">
  <input onblur="if( this.value == '' ) { this.value = this.defaultValue }; return true; "
        onfocus="if( this.value == this.defaultValue ) { this.value = ''}; return true; "
           type="text" value="Quick Navigation"
           name="query" id="query"
           size="20" 
      accesskey="f" />
  <button type="submit"
  		 name="searchSubmit" id="searchSubmit"
  		value="Go!"
  		title="Go!"></button>
  </div>
  <div id="searchboxMenu" style='visibility:hidden;'>
    <div id="searchTools">
      <a href="#" id='quickView' class='action'
      onclick="SearchBox.navigate( 'Wiki195c.html?page=__PAGEHERE__','View the selected page' );"
        title="View the selected page">view</a>
      <a href="#" id='quickEdit' class='action'
      onclick="SearchBox.navigate( 'Logine830.html?page=__PAGEHERE__','Edit the selected page' );"
        title="Edit the selected page">edit</a>
      <a href="#" id='quickClone' class='action'	
      onclick="return SearchBox.navigate( 'Logine830.html?page=__PAGEHERE__', 'Clone the selected page', true );"
        title="Clone the selected page">clone</a>
      <a href="#" id="advancedSearch" class='action'
      onclick="SearchBox.navigate( 'Search136d.html?query=__PAGEHERE__','OTP' )"
        title="Advanced Search [ f ]">find</a>
    </div>
    <div id="searchResult" >
	  Quick search
      <span id="searchTarget" >(type ahead)</span>
      <span id="searchSpin" class="spin" style="position:absolute;display:none;"></span>
	  <div id="searchOutput" ></div>
    </div>
    <div id="recentSearches" style="display:none;">
      Recent Searches
      <span><a href="#" id="recentClear">(Clear)</a></span>
    </div>
  </div>

</form></div>

  <div class="breadcrumbs">Your trail:&nbsp;<a class="wikipage" href="Wiki7f5c.html?page=WikiName">WikiName</a>, <a class="wikipage" href="Wiki8c3c.html?page=WikiVariables">WikiVariables</a>, <a class="wikipage" href="Wiki8e8b.html?page=WikiForms">WikiForms</a>, <a class="wikipage" href="Wikiabdd.html?page=JSF">JSF</a>, <a class="wikipage" href="Wiki0665.html?page=TemplateValidity">TemplateValidity</a>, <a class="wikipage" href="Wiki5ced.html?page=RightFirstTime">RightFirstTime</a>, <a class="wikipage" href="Wikid989.html?page=Javascript">Javascript</a>, <a class="wikipage" href="Wikia36a.html?page=RSAC">RSAC</a>, <a class="wikipage" href="Wikib036.html?page=SpringAPI">SpringAPI</a>, <a class="wikipage" href="Wiki1f75.html?page=RSFHibernate">RSFHibernate</a></div>

</div>

  <div id="content">

    <div id="page">
      





<div id="actionsTop" class="pageactions"> 
  <ul>

    
    
    

    
    <li id="morebutton">
      <a href="Wiki81b4.html?page=MoreMenu" class="action more">More...</a>
    </li>

  </ul>
</div>

      








<div class="tabmenu">

  

  

  
  
  
    
  
    
  



  <a class="activetab" id="menu-pagecontent" accesskey="v" ><span class='accesskey'>V</span>iew</a>

  

  
  <a id="menu-attach" accesskey="a" ><span class='accesskey'>A</span>ttach</a>
  
    
  <a id="menu-info" href='PageInfof73b.html?page=OTP' accesskey="i" ><span class='accesskey'>I</span>nfo</a>
    
  

</div>
<div class="tabs">

  <div id="pagecontent" >

    











<p>The &quot;One True Path&quot; (OTP) philosophy (or convention) is the cornerstone of the treatment of ORM (Object-relational mapping) in RSF. It states that for every (persistent) entity in the system, it can be found at one &quot;true&quot; or &quot;canonical&quot; <tt>EL</tt> path. This is derived from its entity name (as defined by the ORM solution, e.g. Hibernate) and its entity ID in a simple way - for example, an entity of type <tt>Recipe</tt> with an id of <tt>ea6b</tt> can be found at the (request) <a class="wikipage" href="Wiki2b2a.html?page=EL">EL</a> path
</p><pre>
#{Recipe.ea6b}
</pre>
<p>Note that this &quot;same&quot; entity will obviously appear at a great many other EL paths (for example as members of (HQL) query beans). The OTP path is generally special since it is typically the only path at which data can be 'written', and also enjoys some guarantees of quick access. However note that for some query patterns, individual queries by id will not be the most effective access pattern, and the OTP pattern might need to be adapted. The OTP path is generally the <i>shortest</i> EL path at which a particular entity can be accessed.
</p>
<p>This approach is practical in RSF because of its combination of <a class="wikipage" href="Wikia36a.html?page=RSAC">RSAC</a> and <a class="wikipage" href="Wiki2b2a.html?page=EL">EL bindings</a> which allow dependencies on request entities to be injected INTO beans representing application logic, rather than the other way round as happens in so many other frameworks.
<h3 id="section-OTP-QuickOTPUsingTheEntityBeanLocator">Quick OTP using the <a class="wikipage" href="Wiki62e5.html?page=EntityBeanLocator">EntityBeanLocator</a><a class="hashlink" href="#section-OTP-QuickOTPUsingTheEntityBeanLocator">#</a></h3>
</p>
<p><a class="wikipage" href="Wiki62e5.html?page=EntityBeanLocator">EntityBeanLocator</a> is a standard framework interface in RSF, that comes with a default implementation which makes writing an OTP space for an entity very easy, given just a standard &quot;DAO-type&quot; API managing the entity. This API would expose standard methods such as &quot;find by ID&quot;, &quot;save&quot;, &quot;remove&quot; etc. Go to the dedicated page on <a class="wikipage" href="Wiki62e5.html?page=EntityBeanLocator">EntityBeanLocator</a> for the &quot;quick path&quot;, or carry on reading here to learn more about low-level mechanics for OTP.
</p>
<h3 id="section-OTP-AnOTPBeanLocatorWrittenOutLonghand"> An OTP BeanLocator written out longhand<a class="hashlink" href="#section-OTP-AnOTPBeanLocatorWrittenOutLonghand">#</a></h3>
Although RSF automates the creation of OTP &quot;locators&quot; in many cases (for example, when using RSFHibernate, or EntityBeanLocator), it's useful to see a complete locator written out longhand:
<pre>
public class ScaleBeanLocator implements BeanLocator {
  public static final String NEW_PREFIX = &quot;new &quot;;

  private LocalScaleLogic localScaleLogic;
  // Injection method for application-scope &quot;service&quot; which manages the entities
  public void setLocalScaleLogic(LocalScaleLogic localScaleLogic) {
    this.localScaleLogic = localScaleLogic;
    }
  // Local cache of entities which have been referenced via EL, indexed by Id
  private Map delivered = new HashMap();

  // Implements the BeanLocator interface
  public Object locateBean(String path) {
    Object togo = delivered.get(path);
    if (togo == null) {
      if (path.startsWith(NEW_PREFIX)) {
        togo = localScaleLogic.newScale();
      } else {
        togo = localScaleLogic.fetchScale(path);
        }
      delivered.put(path, togo);
      }
    return togo;
    }

    public void saveAll() {
      for (Iterator it = delivered.keySet().iterator(); it.hasNext();) {
        String key = (String) it.next();
        EvalScale scale = (EvalScale) delivered.get(key);
        if (key.startsWith(NEW_PREFIX)) {
          // could be a special case in some models
          }
        localScaleLogic.saveScale(scale);
        }
      }
    }
</pre>
<p>The key point to notice is the private HashMap <tt>delivered</tt> of the <tt>EvalScale</tt> entities which this locator deals in. This is a private cache which is built up in this request-scope locator of all the entities which have been so far referred to via EL - every time a previously unreferenced <tt>EvalScale</tt> is referred to over the request, the backing service <tt>LocalScaleLogic</tt> is queried for the <tt>EvalScale</tt>, and it is stashed in the <tt>delivered</tt> map before it is returned. 
</p>
<p>At the end of a request, where we know some <tt>EvalScale</tt> modifications have been done, we call call the <tt>saveAll()</tt> method (perhaps using a <a class="wikipage" href="Wikiac49.html?page=PrimitiveComponents">UICommand</a> <a class="wikipage" href="Wiki53e2.html?page=Bindings">method binding</a> of something like <tt>#{
scaleBeanLocator.saveAll} </tt> which will then traverse the map, using the backing service again to save every value which has been modified.
</p>
<h3 id="section-OTP-NewEntitiesConvention">&quot;New&quot; entities convention<a class="hashlink" href="#section-OTP-NewEntitiesConvention">#</a></h3>
Part of the OTP standard is the treatment of &quot;new&quot; entities that are being created during the request cycle. By convention, these are all given names beginning with the string &quot;<tt>new </tt>&quot; (that is, lower-case &quot;new&quot; followed by a single space) - the string following this prefix is arbitrary, with the natural idea that mentioning the same suffix will refer to the same &quot;new&quot; bean within the request cycle. At the end of the cycle, &quot;new&quot; beans are committed/persisted by some ORM-dependent semantics. For example, when using RSFHibernate, they are registered with the <tt>receiveNewEntity</tt> method of <a class="external" href="https://saffron.caret.cam.ac.uk/svn/projects/RSFHibernate/trunk/src/java/uk/org/ponder/rsf/hibernate/HibernateEntityBeanManager.java">HibernateEntityBeanManager</a><img class="outlink" src="images/out.png" alt="" />, and then all passed in sequence to <tt>session.save()</tt> on successful action request end. This is reasonable behaviour for a wide range of applications, but as you can observe these are all pretty short classes that are easy to reimplement and replace. The key point is that adhering to OTP EL semantics enables an enormous variety of implementations to be supported without altering application code or idioms.
<h3 id="section-OTP-ExamplesAndRelatedConcepts">Examples and related concepts<a class="hashlink" href="#section-OTP-ExamplesAndRelatedConcepts">#</a></h3>
See <a class="wikipage" href="Wikicb8a.html?page=HibernateCookBook_4">page 4</a> of the &quot;Hibernate Cookbook&quot; app for an example of OTP in action, in this case using the automatic locators created by RSFHibernate.
<p>OTP is related to the concept of <a class="wikipage" href="Wiki022d.html?page=BeanExploder">BeanExploders</a> - the address space provided by both schemes look identical to users, but where each OTP bean is different as a result of being fetched from persistent store, each exploded bean is a &quot;throwaway&quot; copy of the &quot;same&quot; bean.
</p>
<p>OTP can be seen as part of the <a class="wikipage" href="Wiki341c.html?page=BeanReasonableness">BeanReasonableness</a> initiative, in that it is designed to avoid the &quot;same&quot; path referring to &quot;different&quot; beans<a class="footnoteref" href="#ref-OTP-1">[1]</a>. .It enables the bean classes produced by an ORM solution such as <a class="external" href="http://www.hibernate.org/">Hibernate</a><img class="outlink" src="images/out.png" alt="" /> to be <i>directly</i> usable within a web application without the usual need for a &quot;controller&quot; or &quot;bridging&quot; layer designed to abstract away their usually obnoxious semantics. 
</p>
<p>There is some more historical and less well-focused discussion on OTP in the page on <a class="wikipage" href="Wikibcf8.html?page=ObstinateMap">ObstinateMap</a>s.
</p>
<hr />
<a class="footnote" name="ref-OTP-1">[#1]</a>In computer-theoretic terms, BeanReasonableness could be seen as another way of looking at <a class="external" href="http://en.wikipedia.org/wiki/Referential_transparency">referential transparency</a><img class="outlink" src="images/out.png" alt="" />







        
  </div>


  

  
  <div id="attach" class="hidetab" >

    










<div id="addattachment">
<h3>Add new attachment</h3>


<div class="formhelp">Only authorized users are allowed to upload new attachments.</div>

</div>



  </div>

  
    
  <div id="info" class="hidetab" >

  </div>

    
  

<div style="clear:both;" ></div>
</div>

      







<div id='actionsBottom' class="pageactions"> 
    

    <a href="#top" 
      class="action quick2top" 
      title="Go to top" >&laquo;</a>

    
       This page (revision-) was last changed on <a href="Diffb6a7.html?page=OTP&amp;r1=-1&amp;r2=1">28-Jul-2008 14:18</a> by UnknownAuthor
    

    

   

  

   
</div>

    </div>

    






<div id="favorites">

  






<div class="userbox">

  
    <span class="username anonymous">
      G&#8217;day (anonymous guest)
    </span>
  
  
  

  
  
  
    
      <a href="Loginae2f.html?redirect=OTP" 
        class="action login"
        title="Log in or Register as new user">Log in</a>
    
  
  
  
  

  
  
    <a href="UserPreferencesae2f.html?redirect=OTP"
      class="action prefs" accesskey="p"
      title="Manage your preferences [ p ]">My <span class='accesskey'>P</span>refs
    </a>
  
  

  <div class="clearbox"></div>

</div>
  
  <div id="hiddenmorepopup">
  <ul id="morepopup">
     
       	
     
       
     
    
       
     
       <li>
       
       <a class="action rawpage wikipage" 
               href="Wiki4d93.html?page=OTP&amp;skin=raw"
              title="View Page Source">View Page Source
       </a>
       
       
       </li>
      
        
  
      
      
      

      
	  <li class='separator'>
        <div id="moremenu" ></div>
      </li>
  </ul>
  </div>
  
  

  

  

  
  <div class="leftmenu">
    <p><a class="wikipage" href="Wikib2ab.html?page=Main">Main page</a><br />
<tt> </tt><i><a class="wikipage" href="Wiki4d3f.html?page=ThisWiki">About</a></i><br />
</p><p><a class="wikipage" href="Wikid6f0.html?page=GettingStarted">Getting Started</a><br />
</p>
<p><b>Documentation</b><br />
<tt> </tt><a class="wikipage" href="Wiki4c8c.html?page=Developers">Developers</a><br />
<tt>  </tt><a class="wikipage" href="Wikib1ce.html?page=Javadocs">Javadocs</a><br />
<tt> </tt><a class="wikipage" href="Wikia56b.html?page=Designers">Designers</a><br />
<tt> </tt><a class="wikipage" href="Wiki4509.html?page=SampleRSFApps">Sample RSF Apps</a><br />
<tt> </tt><a class="wikipage" href="Wikif010.html?page=Presentations">Presentations</a><br />
<tt> </tt><a class="wikipage" href="Wiki45f9.html?page=Acronyms">Acronyms</a><br />
</p>
<p><b>Downloads</b><br />
<tt> </tt><a class="wikipage" href="Wiki30c9.html?page=CurrentCode">Current Release</a><br />
<tt> </tt><a class="wikipage" href="Wiki0e27.html?page=TrunkCode">Trunk</a><br />
<tt> </tt><a class="wikipage" href="Wiki1a8d.html?page=CodeDistributions">Distributions</a><br />
<tt> </tt><a class="wikipage" href="Wikiadaf.html?page=OldCode">Old Versions</a><br />
</p>
<p><b>Community</b><br />
<tt> </tt><a class="wikipage" href="Wiki84f4.html?page=QampA">Q&amp;A</a><br />
<tt> </tt><a class="external" href="http://ponder.org.uk/rsf/">Forums</a><img class="outlink" src="images/out.png" alt="" /><br />
<tt> </tt><a class="wikipage" href="Wikif345.html?page=EmailLists">Mailing Lists</a><br />
<tt> </tt><a class="external" href="http://www.caret.cam.ac.uk/jira/browse/RSF">Issue Tracker</a><img class="outlink" src="images/out.png" alt="" /><br />
<tt> </tt><a class="wikipage" href="Wiki1535.html?page=People">People</a><br />
</p>
<p><b>Design</b><br />
<tt> </tt><a class="wikipage" href="Wiki580c.html?page=Roadmap">Roadmap</a><br />
<tt> </tt><a class="wikipage" href="Wiki654d.html?page=Integrations">Integrations</a><br />
<tt> </tt><a class="wikipage" href="Wikia360.html?page=Concepts">Concepts</a><br />
<tt> </tt><a class="wikipage" href="Wiki151d.html?page=Philosophy">Philosophy</a><br />
</p>
<div style="font-style:italic;font-size:0.8em;">
<b>Pages</b><br />
<tt> </tt><a class="wikipage" href="Wiki702d.html?page=FindPage">Find</a><br />
<tt> </tt><a class="wikipage" href="Wiki5fc7.html?page=RecentChanges">Recent Changes</a><br />
<tt> </tt><a class="wikipage" href="Wikife97.html?page=UnusedPages">Unused</a><br />
<tt> </tt><a class="wikipage" href="Wiki5130.html?page=UndefinedPages">Undefined</a><br />
<tt> </tt><a class="wikipage" href="Wiki5f9e.html?page=PageIndex">Index</a>
</div>
<p />
    
  </div>
  
  <div class="leftmenufooter">
    <hr />
<p><b>Referenced by</b><br />
<a class="wikipage" href="Wiki45f9.html?page=Acronyms">Acronyms</a><br /><a class="wikipage" href="Wiki0fd1.html?page=ActionResultInterceptor">ActionResultIntercep...</a><br /><a class="wikipage" href="Wiki6979.html?page=BeanLocator">BeanLocator</a><br /><a class="wikipage" href="Wiki517d.html?page=BuildingRSFComponents">BuildingRSFComponent...</a><br /><a class="wikipage" href="Wikia360.html?page=Concepts">Concepts</a><br /><a class="wikipage" href="Wiki4c8c.html?page=Developers">Developers</a><br /><a class="wikipage" href="Wikiff9f.html?page=Disintegrations">Disintegrations</a><br /><a class="wikipage" href="Wiki2b2a.html?page=EL">EL</a><br /><a class="wikipage" href="Wiki62e5.html?page=EntityBeanLocator">EntityBeanLocator</a><br /><a class="wikipage" href="Wiki312a.html?page=EntityNameInferrer">EntityNameInferrer</a><br /><br /><a class='morelink' href='PageInfof73b.html?page=OTP' >...and 14 more</a><br />
</p>
    
  </div>

  

  
  
  <div class="wikiversion">JSPWiki v2.8.2
  <span class="rssfeed">
    
  </span>
  </div>  
  
</div>

	<div class="clearbox"></div>
  </div>

  





 
<div id="footer">

  <div class="applicationlogo" > 
    <a href="Wikib2ab.html?page=Main"
       title="Go to home page Main ">Home</a>
  </div>

  <div class="companylogo"></div>

  <div class="copyright"></div>

  <div class="wikiversion">
    JSPWiki v2.8.2
  </div>

  <div class="rssfeed">
    
  </div>

</div>

</div>

</body>

<!-- Mirrored from rsf.fluidproject.org/wiki/Wiki.jsp?page=OTP by HTTrack Website Copier/3.x [XR&CO'2013], Fri, 07 Jun 2013 15:00:32 GMT -->
</html>

