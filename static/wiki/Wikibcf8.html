











<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html id="top" xmlns="http://www.w3.org/1999/xhtml">


<!-- Mirrored from rsf.fluidproject.org/wiki/Wiki.jsp?page=ObstinateMap by HTTrack Website Copier/3.x [XR&CO'2013], Fri, 07 Jun 2013 15:15:45 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
  <title>
    RSF Wiki: ObstinateMap
  </title>
  











<link rel="stylesheet" media="screen, projection, print" type="text/css"
     href="templates/default/jspwiki.css"/>

<link rel="stylesheet" type="text/css" media="print" 
     href="templates/default/jspwiki_print.css" />
<!-- INCLUDERESOURCES (stylesheet) -->

<!-- INCLUDERESOURCES (inlinecss) -->



<noscript>
<style type="text/css">
#hiddenmorepopup { display:block; }
</style>
</noscript>


<script type="text/javascript" src="scripts/mootools.js"></script>
<script type="text/javascript" src="scripts/prettify.js"></script>
<script type="text/javascript" src="scripts/jspwiki-common.js"></script>
<script type="text/javascript" src="scripts/jspwiki-commonstyles.js"></script>
<!-- INCLUDERESOURCES (script) -->





<meta name="wikiContext" content='view' />
<meta name="wikiBaseUrl" content='http://rsf.fluidproject.org/wiki/' />
<meta name="wikiPageUrl" content='/wiki/Wiki.jsp?page=%23%24%25' />
<meta name="wikiEditUrl" content='/wiki/Edit.jsp?page=ObstinateMap' />
<meta name="wikiJsonUrl" content='/wiki/JSON-RPC' />
<meta name="wikiPageName" content='ObstinateMap' />
<meta name="wikiUserName" content='207.119.0.6' />
<meta name="wikiTemplateUrl" content='/wiki/templates/default/' />
<meta name="wikiApplicationName" content='RSF Wiki' />

<script type="text/javascript">//<![CDATA[
/* Localized javascript strings: LocalizedStrings[] */
var LocalizedStrings = {
"javascript.edit.allsections":"( All )",
"javascript.slimbox.error":"<h2>Error</h2>There was a problem with your request.<br />Please try again",
"javascript.slimbox.remoteRequest":"Remote Request {0} of {1}",
"javascript.slimbox.close":"Close &#215;",
"javascript.quick.edit":"[Edit]",
"javascript.sort.descending":"Descending order. Click to reverse sort order",
"javascript.expand":"Click to expand",
"javascript.group.validName":"Please provide a valid name for the new Group",
"javascript.slimbox.next":"Next&raquo;",
"javascript.filter.all":"( All )",
"javascript.edit.areyousure":"Without clicking the Save button, your changes will be lost. Are you sure you want to exit this page?",
"javascript.quick.edit.title":"Edit section {0}...",
"javascript.slimbox.directLink":"Direct Link to the target",
"javascript.prefs.areyousure":"Without clicking the Save User Preferences button, your changes will be lost. Are you sure you want to exit this page?",
"javascript.sbox.clone.suffix":"-New",
"javascript.slimbox.info":"Image {0} of {1}",
"javascript.tip.default.title":"More...",
"javascript.edit.resize":"Drag to resize the text area",
"javascript.edit.findandreplace.nomatch":"No match found!",
"javascript.sort.ascending":"Ascending order. Click to reverse sort order",
"javascript.slimbox.close.title":"Close [Esc]",
"javascript.edit.toolbar.makeSelection":"Please make first a selection.",
"javascript.favs.hide":"Click to hide Favorites",
"javascript.sectionediting.label":"Section Overview",
"javascript.slimbox.previous":"&laquo;Previous",
"javascript.favs.show":"Click to show Favorites",
"javascript.collapse":"Click to collapse",
"javascript.category.title":"Click to show category [{0}] ...",
"javascript.sort.click":"Click to sort",
"javascript.edit.startOfPage":"( Start of page )"
};


/* INCLUDERESOURCES (jsfunction) */

//]]></script>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="search" href="Wiki702d.html?page=FindPage"
    title='Search RSF Wiki' />
<link rel="help"   href="Wikia3b7.html?page=TextFormattingRules"
    title="Help" />

 <link rel="start"  href="Wikib2ab.html?page=Main"
    title="Front page" />
<link rel="alternate stylesheet" type="text/css" href="templates/default/jspwiki_print.css"
    title="Print friendly" />
<link rel="alternate stylesheet" type="text/css" href="templates/default/jspwiki.css"
    title="Standard" />
<link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico" />

<link rel="icon" type="image/x-icon" href="images/favicon.ico" />



  









  
  
  
</head>

<body class="view">

<div id="wikibody" class="fav-left">
 
  






<div id="header">

  <div class="titlebox"></div>

  <div class="applicationlogo" > 
    <a href="Wikib2ab.html?page=Main"
       title="Go to home page Main ">Home</a>
  </div>

  <div class="companylogo"></div>

  






<div class="userbox">

  
    <span class="username anonymous">
      G&#8217;day (anonymous guest)
    </span>
  
  
  

  
  
  
    
      <a href="Login2484.html?redirect=ObstinateMap" 
        class="action login"
        title="Log in or Register as new user">Log in</a>
    
  
  
  
  

  
  
    <a href="UserPreferences2484.html?redirect=ObstinateMap"
      class="action prefs" accesskey="p"
      title="Manage your preferences [ p ]">My <span class='accesskey'>P</span>refs
    </a>
  
  

  <div class="clearbox"></div>

</div>

  <div class="pagename">ObstinateMap</div>

  <div class="searchbox">






<form action="http://rsf.fluidproject.org/wiki/Search.jsp"
        class="wikiform"
           id="searchForm" accept-charset="UTF-8">

  <div style="position:relative">
  <input onblur="if( this.value == '' ) { this.value = this.defaultValue }; return true; "
        onfocus="if( this.value == this.defaultValue ) { this.value = ''}; return true; "
           type="text" value="Quick Navigation"
           name="query" id="query"
           size="20" 
      accesskey="f" />
  <button type="submit"
  		 name="searchSubmit" id="searchSubmit"
  		value="Go!"
  		title="Go!"></button>
  </div>
  <div id="searchboxMenu" style='visibility:hidden;'>
    <div id="searchTools">
      <a href="#" id='quickView' class='action'
      onclick="SearchBox.navigate( 'Wiki195c.html?page=__PAGEHERE__','View the selected page' );"
        title="View the selected page">view</a>
      <a href="#" id='quickEdit' class='action'
      onclick="SearchBox.navigate( 'Logine830.html?page=__PAGEHERE__','Edit the selected page' );"
        title="Edit the selected page">edit</a>
      <a href="#" id='quickClone' class='action'	
      onclick="return SearchBox.navigate( 'Logine830.html?page=__PAGEHERE__', 'Clone the selected page', true );"
        title="Clone the selected page">clone</a>
      <a href="#" id="advancedSearch" class='action'
      onclick="SearchBox.navigate( 'Search136d.html?query=__PAGEHERE__','ObstinateMap' )"
        title="Advanced Search [ f ]">find</a>
    </div>
    <div id="searchResult" >
	  Quick search
      <span id="searchTarget" >(type ahead)</span>
      <span id="searchSpin" class="spin" style="position:absolute;display:none;"></span>
	  <div id="searchOutput" ></div>
    </div>
    <div id="recentSearches" style="display:none;">
      Recent Searches
      <span><a href="#" id="recentClear">(Clear)</a></span>
    </div>
  </div>

</form></div>

  <div class="breadcrumbs">Your trail:&nbsp;<a class="wikipage" href="Wiki0435.html?page=SakaiRSF">SakaiRSF</a>, <a class="wikipage" href="Wiki62b8.html?page=CocoonRSFIntegration">CocoonRSFIntegration</a>, <a class="wikipage" href="Wikiac81.html?page=SessionConsideredHarmful">SessionConsideredHarmful</a>, <a class="wikipage" href="Wikifbf9.html?page=RIFEContinuations">RIFEContinuations</a>, <a class="wikipage" href="Wikie3fa.html?page=Qwicap">Qwicap</a>, <a class="wikipage" href="Wiki1a86.html?page=LogonTest_1">LogonTest_1</a>, <a class="wikipage" href="Wiki022d.html?page=BeanExploder">BeanExploder</a>, <a class="wikipage" href="Wiki6979.html?page=BeanLocator">BeanLocator</a>, <a class="wikipage" href="Wiki341c.html?page=BeanReasonableness">BeanReasonableness</a>, <a class="wikipage" href="Wiki7132.html?page=Levelization">Levelization</a></div>

</div>

  <div id="content">

    <div id="page">
      





<div id="actionsTop" class="pageactions"> 
  <ul>

    
    
    

    
    <li id="morebutton">
      <a href="Wiki81b4.html?page=MoreMenu" class="action more">More...</a>
    </li>

  </ul>
</div>

      








<div class="tabmenu">

  

  

  
  
  
    
  
    
  



  <a class="activetab" id="menu-pagecontent" accesskey="v" ><span class='accesskey'>V</span>iew</a>

  

  
  <a id="menu-attach" accesskey="a" ><span class='accesskey'>A</span>ttach</a>
  
    
  <a id="menu-info" href='PageInfobcf8.html?page=ObstinateMap' accesskey="i" ><span class='accesskey'>I</span>nfo</a>
    
  

</div>
<div class="tabs">

  <div id="pagecontent" >

    











<p>NB - this page contains mainly historical reflections on a particular aspect of RSF architecture. I will try to refactor it to separate out the historical and current parts, but it touches in general on an interesting and fundamental part of the RSF philosophy and practice, so it is worth skimming through if you are that way inclined.
</p><hr />
The ObstinateMap first appeared during various attempts to coerce JSF to directly use a <a class="wikipage" href="Wiki341c.html?page=BeanReasonableness">reasonable</a> bean model as its direct request scope bean model. This was prompted by the observation that the default <tt>javax.beans.*</tt> introspector was capable of recognising a Map-valued property which would then &quot;masquerade&quot; as an object, with the <a class="wikipage" href="Wiki2b2a.html?page=EL">EL</a> path component at that point representing a key to the map, with the resulting property value being taken from the value of the map<a class="footnoteref" href="#ref-ObstinateMap-1">[1]</a>.
<p>The idea is for the root of the request bean scope as well (or even instead of) as containing some plain value beans, to be populated with <a class="wikipage" href="Wiki6979.html?page=BeanLocator">&quot;bean locators&quot;</a>, which were essentially representations of the <i>entire</i> data model of the app masquerading as very big maps, with the keys being some form of unique string, perhaps a database key. This aids <a class="wikipage" href="Wiki341c.html?page=BeanReasonableness">BeanReasonableness</a> in that now the identity of a request scope bean is completely unambiguous, even if beans with the same paths in different request scopes temporarily have different values as a result of pending changes. The value of this kind of reasonableness on app coherency is incalculable... 
</p>
<p>In order to get this to work correctly with JSF, a special kind of map was needed that would simply refuse to disgorge anything that might inadvertently cause the entire datamodel to be loaded, as JSF would frequently attempt on discovering anything implementing <tt>java.util.Map</tt>. Hence the ObstinateMap was created, which is still enshrined in the <a class="createpage" href="Login7770.html?page=PonderUtilCore" title="Create &quot;PonderUtilCore&quot;">PonderUtilCore</a> library, which as a first pass would serve as a &quot;trip-wire&quot; by throwing exceptions to show the location within JSF code where some dangerous operation was attempted, but would ultimately behave &quot;minimally&quot; with respect to them by divulging only the key/value pairs that had previously been requested using get/put.
</p>
<h3 id="section-ObstinateMap-FastEL"> Fast EL<a class="hashlink" href="#section-ObstinateMap-FastEL">#</a></h3>
This approach was abandoned in favour of the &quot;Fast <a class="wikipage" href="Wiki2b2a.html?page=EL">EL</a>&quot; architecture which is still present in RSF (carried over from the days of JSFUtil), since it was just too awkward to persuade the JSF bean architecture to wire a dependency <i>from</i> the action-invoking bean <i>to</i> the (different for every request) state-holding bean. In RSFUtil, Fast EL has been upgraded to solve this task even more fully by wiring the relevant object reference directly. Put simply, it was a &quot;fast track&quot; for some EL parameters to be bound earlier than others, in order to inform a bean of its intended identify before values were applied to it. The &quot;Fast EL&quot; architecture of JSFUtil was almost abandoned in the transition to RSFUtil as a gross <a class="wikipage" href="Wiki341c.html?page=BeanReasonableness">BeanReasonableness</a>, but it was discovered that it could even be improved by accepting EL as the 'r-value' as well as an 'l-value'.
<h3 id="section-ObstinateMap-BeanLocators"> BeanLocators<a class="hashlink" href="#section-ObstinateMap-BeanLocators">#</a></h3>
A return to the original plan for the ObstinateMap is now planned - but since we are now in full control of the manipulation of the request writeable bean model, there is no real need for such caution in Maps, although it should be noted that the <tt>java.util.Map</tt> interface is so unnecessarily huge that there is still some value in having a wrapper for it like this. However, since we DO have full control over the EL evaluator, the approach taken will probably be to adopt a new interface, probably simply the BeanGetter interface from PonderUtilCore. 
<pre>
public interface BeanGetter {
  public Object getBean(String beanname);
}
</pre>
This is the minimum necessary abstraction, that of getting a bean. setBean() will not be implemented in this interface because of the somewhat unusual semantics behind entity creation in most ORM solutions, which require a full round-trip to the database before the ID of an object can be assigned. Instead, we will adopt &quot;placeholder IDs&quot; for objects under fresh construction and continue to use getBean() - e.g. application EL can safely refer to paths of the form 
<pre> beanlocator.['new bean-1'].property1 </pre>
in a particular request scope and be sure to be consistently referring to an entity not yet created until the (possibly <a class="wikipage" href="Wiki6c20.html?page=MultiRequest">multi-request</a>) transaction is committed at some later time.
<p>Together with the reflection on <a class="wikipage" href="Wiki96a7.html?page=DeadBeans">DeadBeans</a>, which removes any need to be &quot;shadowing&quot; the client's data model while it is being built up, once again the ObstinateMap dies a death, to slumber in the Attic where dead code dreams...
</p>
<p />
<hr />
<a class="footnote" name="ref-ObstinateMap-1">[#1]</a> Note that since the map key might in general be a string containing invalid characters for a Java property name (in particular containing some dots itself) this require(d/s) the extended EL syntax 
<pre>
  #{beanname.['invalid property.name as Java'].property2}
</pre>
<p />
<hr />
<span style="color: #666666; font-family: sans-serif; font-size:80%">You can post comments and questions on this page using the following blog. Please set your name using <a class="wikipage" href="Wiki7eba.html?page=UserPreferences">UserPreferences</a> before posting.</span>
<div class="weblog">
</div>

<a href="Logincf1a.html?page=ObstinateMap">New entry</a>







        
  </div>


  

  
  <div id="attach" class="hidetab" >

    










<div id="addattachment">
<h3>Add new attachment</h3>


<div class="formhelp">Only authorized users are allowed to upload new attachments.</div>

</div>



  </div>

  
    
  <div id="info" class="hidetab" >

  </div>

    
  

<div style="clear:both;" ></div>
</div>

      







<div id='actionsBottom' class="pageactions"> 
    

    <a href="#top" 
      class="action quick2top" 
      title="Go to top" >&laquo;</a>

    
       This page (revision-) was last changed on <a href="Difff582.html?page=ObstinateMap&amp;r1=-1&amp;r2=1">19-Jul-2006 09:36</a> by UnknownAuthor
    

    

   

  

   
</div>

    </div>

    






<div id="favorites">

  






<div class="userbox">

  
    <span class="username anonymous">
      G&#8217;day (anonymous guest)
    </span>
  
  
  

  
  
  
    
      <a href="Login2484.html?redirect=ObstinateMap" 
        class="action login"
        title="Log in or Register as new user">Log in</a>
    
  
  
  
  

  
  
    <a href="UserPreferences2484.html?redirect=ObstinateMap"
      class="action prefs" accesskey="p"
      title="Manage your preferences [ p ]">My <span class='accesskey'>P</span>refs
    </a>
  
  

  <div class="clearbox"></div>

</div>
  
  <div id="hiddenmorepopup">
  <ul id="morepopup">
     
       	
     
       
     
    
       
     
       <li>
       
       <a class="action rawpage wikipage" 
               href="Wiki32e8.html?page=ObstinateMap&amp;skin=raw"
              title="View Page Source">View Page Source
       </a>
       
       
       </li>
      
        
  
      
      
      

      
	  <li class='separator'>
        <div id="moremenu" ></div>
      </li>
  </ul>
  </div>
  
  

  

  

  
  <div class="leftmenu">
    <p><a class="wikipage" href="Wikib2ab.html?page=Main">Main page</a><br />
<tt> </tt><i><a class="wikipage" href="Wiki4d3f.html?page=ThisWiki">About</a></i><br />
</p><p><a class="wikipage" href="Wikid6f0.html?page=GettingStarted">Getting Started</a><br />
</p>
<p><b>Documentation</b><br />
<tt> </tt><a class="wikipage" href="Wiki4c8c.html?page=Developers">Developers</a><br />
<tt>  </tt><a class="wikipage" href="Wikib1ce.html?page=Javadocs">Javadocs</a><br />
<tt> </tt><a class="wikipage" href="Wikia56b.html?page=Designers">Designers</a><br />
<tt> </tt><a class="wikipage" href="Wiki4509.html?page=SampleRSFApps">Sample RSF Apps</a><br />
<tt> </tt><a class="wikipage" href="Wikif010.html?page=Presentations">Presentations</a><br />
<tt> </tt><a class="wikipage" href="Wiki45f9.html?page=Acronyms">Acronyms</a><br />
</p>
<p><b>Downloads</b><br />
<tt> </tt><a class="wikipage" href="Wiki30c9.html?page=CurrentCode">Current Release</a><br />
<tt> </tt><a class="wikipage" href="Wiki0e27.html?page=TrunkCode">Trunk</a><br />
<tt> </tt><a class="wikipage" href="Wiki1a8d.html?page=CodeDistributions">Distributions</a><br />
<tt> </tt><a class="wikipage" href="Wikiadaf.html?page=OldCode">Old Versions</a><br />
</p>
<p><b>Community</b><br />
<tt> </tt><a class="wikipage" href="Wiki84f4.html?page=QampA">Q&amp;A</a><br />
<tt> </tt><a class="external" href="http://ponder.org.uk/rsf/">Forums</a><img class="outlink" src="images/out.png" alt="" /><br />
<tt> </tt><a class="wikipage" href="Wikif345.html?page=EmailLists">Mailing Lists</a><br />
<tt> </tt><a class="external" href="http://www.caret.cam.ac.uk/jira/browse/RSF">Issue Tracker</a><img class="outlink" src="images/out.png" alt="" /><br />
<tt> </tt><a class="wikipage" href="Wiki1535.html?page=People">People</a><br />
</p>
<p><b>Design</b><br />
<tt> </tt><a class="wikipage" href="Wiki580c.html?page=Roadmap">Roadmap</a><br />
<tt> </tt><a class="wikipage" href="Wiki654d.html?page=Integrations">Integrations</a><br />
<tt> </tt><a class="wikipage" href="Wikia360.html?page=Concepts">Concepts</a><br />
<tt> </tt><a class="wikipage" href="Wiki151d.html?page=Philosophy">Philosophy</a><br />
</p>
<div style="font-style:italic;font-size:0.8em;">
<b>Pages</b><br />
<tt> </tt><a class="wikipage" href="Wiki702d.html?page=FindPage">Find</a><br />
<tt> </tt><a class="wikipage" href="Wiki5fc7.html?page=RecentChanges">Recent Changes</a><br />
<tt> </tt><a class="wikipage" href="Wikife97.html?page=UnusedPages">Unused</a><br />
<tt> </tt><a class="wikipage" href="Wiki5130.html?page=UndefinedPages">Undefined</a><br />
<tt> </tt><a class="wikipage" href="Wiki5f9e.html?page=PageIndex">Index</a>
</div>
<p />
    
  </div>
  
  <div class="leftmenufooter">
    <hr />
<p><b>Referenced by</b><br />
<a class="wikipage" href="Wiki91dd.html?page=BeanReasonablenessRationale">BeanReasonablenessRa...</a><br /><a class="wikipage" href="Wikia360.html?page=Concepts">Concepts</a><br /><a class="wikipage" href="Wikif73b.html?page=OTP">OTP</a><br />
</p>
    
  </div>

  

  
  
  <div class="wikiversion">JSPWiki v2.8.2
  <span class="rssfeed">
    
  </span>
  </div>  
  
</div>

	<div class="clearbox"></div>
  </div>

  





 
<div id="footer">

  <div class="applicationlogo" > 
    <a href="Wikib2ab.html?page=Main"
       title="Go to home page Main ">Home</a>
  </div>

  <div class="companylogo"></div>

  <div class="copyright"></div>

  <div class="wikiversion">
    JSPWiki v2.8.2
  </div>

  <div class="rssfeed">
    
  </div>

</div>

</div>

</body>

<!-- Mirrored from rsf.fluidproject.org/wiki/Wiki.jsp?page=ObstinateMap by HTTrack Website Copier/3.x [XR&CO'2013], Fri, 07 Jun 2013 15:15:47 GMT -->
</html>

